.memory-game {
  text-align: center;
  padding: 2rem;
  width: 600px;
  max-width: 90vw;
  margin: 0 auto;

  .game-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-top: 1rem;
  }

  .card {
    background-color: transparent;
    width: 100%;
    aspect-ratio: 1;
    perspective: 1000px;
    cursor: pointer;
    // Ensure cards don't create layout shifts
    z-index: 1;

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    // State: User is looking at the card (Flipped)
    &.flipped .card-inner {
      transform: rotateY(180deg);
    }

    // State: Card is currently being flipped via click
    &.active .card-inner {
      transform: rotateY(180deg);
    }

    // --- REFACTORED SOLVED STATE ---
    &.solved {

      // 1. Keep the card flipped showing the icon
      .card-inner {
        transform: rotateY(180deg);
      }

      // 2. Style the back (the visible face)
      .card-back {
        // Use the new Ectoplasm Animation
        animation: ectoPulse 2s infinite ease-in-out;

        // Force background/border to stay visible
        background-color: rgba(20, 40, 20, 0.85) !important;
        border: 2px solid #00ff64 !important;

        // Make the icon pop
        color: #00ff64 !important;
        text-shadow: 0 0 10px rgba(0, 255, 100, 0.8);

        // Ensure opacity is full
        opacity: 1;
      }
    }

    .card-front,
    .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .card-front {
      background: rgba(0, 0, 0, 0.5);
      color: var(--brand-puca, #5cb85c);
      font-weight: bold;
    }

    .card-back {
      background: rgba(255, 255, 255, 0.1);
      transform: rotateY(180deg);
    }
  }

  .winner-message {
    margin-top: 3rem;

    h3 {
      font-size: 2rem;
      margin-bottom: 1rem;

      @media (max-width: 600px) {
        font-size: 1.5rem;
      }
    }

    button {
      padding: 1rem 2rem;
      font-size: 1.2rem;
      border-radius: 30px;
      background: var(--brand-puca, green);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: opacity 0.2s;

      &:hover {
        opacity: 0.9;
      }
    }
  }
}

/* --- NEW ECTOPLASM ANIMATION --- */
@keyframes ectoPulse {
  0% {
    box-shadow: 0 0 5px rgba(0, 255, 100, 0.3);
  }

  50% {
    // Glow expands outward
    box-shadow: 0 0 20px rgba(0, 255, 100, 0.6), 0 0 10px rgba(0, 255, 100, 0.4) inset;
  }

  100% {
    box-shadow: 0 0 5px rgba(0, 255, 100, 0.3);
  }
}